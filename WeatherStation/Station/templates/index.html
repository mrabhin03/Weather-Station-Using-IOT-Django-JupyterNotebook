<html>
    <head>
        {% load static %}
        <title>Acalica</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="{% static 'style.css' %}">
        <link rel="icon" href="{% static 'rain.png' %}">
        <script src="{% static 'newjs.js' %}"></script>
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    </head>
    <body class="dark">
        
        {% if Load == "0" %}
        <div class="loader"><h2>Loading</h2><div class="loader_sub"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>
        {% endif %}
        <script>
            var tab_data=0

             function checkTabLoad() {
                if (!sessionStorage.getItem('alertShown')) 
                {
                    tab_data=1
                    switch (window.performance.navigation.type) {
                        case 0:
                        fetch('/loadercall')
                        .then(response => {location.reload();});
                    break;
                }
                sessionStorage.setItem('alertShown', true);
                
            }
        }
        checkTabLoad();
            var perdevice = [0, 1, 2, 5, 11];
            var count = document.querySelectorAll('.loader').length;
            if(count>0){setTimeout(function() {location.reload();}, 5000);}
            var today = new Date();
            var thedatefor = today.getFullYear() + '-' + ('0' + (today.getMonth() + 1)).slice(-2) + '-' + ('0' + today.getDate()).slice(-2);
            var lastdate1=thedatefor;
            var lastdate2=thedatefor;
            var dayvalue=thedatefor
            var dorw=0;
            var didval=2;
            
            
            
        </script>
        <div class="main">
            <div class="temperature">
                <div  class="thead" >
                    <div class="sun">
                    </div>
                    <div  onclick="themechange()" class="themeselect">
                        <p>Dark Mode</p><div class="buttonst"><div  id="switchdata" class="switch"></div></div>
                    </div>
                </div>
                <div class="shead">
                    <table>
                        <tr>
                            <td id="todaydate">
                                She 
                            </td>
                            <td id="todaytime">
                               10 Jun 2003
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="tmep">
                    <div id="todayTemperature">0Â°</div>
                </div>
                <div class="base">
                    <img id="imagedata" src="{% static 'Backgroundicon.png' %}" alt="">
                </div>

            </div>
            {% block details %}
            <div class="details">
                <div class="details_head">
                    <div>
                        <div><b>Welcome to weather station {{ predata }}</b></div>
                        <div>Check out Today's weather information</div>
                    </div>
                </div>
                <div class="details_div1">
                    <div onclick="homegraphdata(0,this)" class="grpoption2"><ion-icon id="homeswitch" name="chevron-back-outline"></ion-icon></div>
                    <div class="gr">
                        <div class="graphtitle">
                            <div id="mainweekday" class="transfer">Today's Temperature</div>
                            <div class="barhead">
                                <div><b> <button onclick="theweekchange()" id="weekorday">Daily weather</button></b></div>
                                <div><button onclick="dateupdations(1)" id='submitBtnpre' name='updatedata'>Previous Day</button>
                                    <button onclick="dateupdations(2)" id='submitBtnnex' name='updatedata'>Next Day</button></div>
                            </div>
                            <div id="thegrlabel" class="barlabel">
                                
                            </div>

                        </div>
                        <div class="canvasdata">
                            <canvas id="graphdisplay" ></canvas>
                        </div>
                    </div>
                    <div onclick="homegraphdata(1,this)" class="grpoption2"><ion-icon id="homeswitch" name="chevron-forward-outline"></ion-icon></div>
                </div>
                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                <script>
                    var k=0
                    var chart
                    newitemarray2=[]
                    function graph(gradata)
                    {
                        newitemarray2=[]
                        const datasets = [];
                        themaingraphlabel=document.getElementById('thegrlabel')
                        themaingraphlabel.innerHTML = '';
                        newlabelarray=[];
                        newitemarray=[];
                        if(dorw==1)
                        {lastdate1=gradata[6].date;}
                        
                        if(dorw==1){li=8}
                        else{li=8}
                        for(i=0;i<gradata.length;i++){
                            const valdata = document.createElement("div");
                            valdata.classList.add("val");
                            const icons = document.createElement("ion-icon");
                            icons.setAttribute("id", 'rainic'+i);
                            const dayst = document.createElement("div");
                            dayst.setAttribute("id", 'daystem'+i);
                            valdata.appendChild(icons);
                            valdata.appendChild(dayst);
                            themaingraphlabel.appendChild(valdata);
                            if(gradata[i].value1==0){$('#daystem'+i).text("---");}
                            else{graphtopanume("daystem"+i,gradata[i].value1,gradata[0].Symbols);}
                            
                            var iconElement = document.getElementById('rainic'+i);
                            iconElement.setAttribute('name', gradata[i].value2);
                            if(dorw==1)
                            {
                                if(i+1<8){
                                newlabelarray[i]=gradata[i].date.split('-')[1]+"/"+gradata[i].date.split('-')[2];}
                                else{newlabelarray[i]="Tomorrow"}
                            }
                            else{newlabelarray[i]=gradata[i].date}
                            if(dorw==1)
                            {
                                if(i+1!=li)
                                {
                                    newitemarray[i]=gradata[i].value1;
                                    if(i+2==li){
                                        newitemarray2[i]=gradata[i].value1;
                                    }
                                }
                                else{
                                    newitemarray2[i]=gradata[i].value1;
                                }
                            }
                            else{
                                if(gradata[i].predicts==0)
                                {
                                    newitemarray[i]=gradata[i].value1;

                                }
                                else{
                                    if(i!=0){
                                    if(gradata[i-1].predicts==0){
                                        newitemarray2[i-1]=gradata[i-1].value1;
                                    }}
                                    newitemarray2[i]=gradata[i].value1;
                                }
                            }
                            
                            
                        }
                        let labels = newlabelarray
                        let itemdata = newitemarray
                        let itemdata2=newitemarray2
                        datasets.push({
                                    label:"Main Values",
                                    data: itemdata,
                                    borderColor: 'rgba(100, 180, 280,1)',
                                    fill: false,
                                    backgroundColor: "rgba(81, 159, 226,0.2)",
                                    tension: 0.15,
                                    borderWidth: 3
                        })
                        datasets.push({
                                    label:"Forcast Values",
                                    data: itemdata2,
                                    borderColor: 'rgb(180, 180, 280)',
                                    fill: false,
                                    backgroundColor: "rgba(81, 159, 226,0.2)",
                                    tension: 0.15,
                                    borderDash: [5, 5],
                                    borderWidth: 3
                        })
                        if(k==0)
                        {
                            const data = {
                                labels: labels,
                                datasets: datasets
                            };
                            const config = {
                                type: 'line',
                                data: data,
                                options: {

                                    plugins: {
                                        legend: {
                                            display: false
                                        },
                                        title: {
                                            display: false,
                                        }
                                    },
                                    scales: {
                                        y: {
                                            grid: {
                                                color: 'rgba(255, 255, 255, 0.1)'
                                            },
                                            ticks:{
                                                color:'white'
                                            }
                                        },
                                        x: {
                                            grid: {
                                                color: 'rgba(255, 255, 255, 0.1)'
                                            },
                                            ticks:{
                                                color:'white'
                                            }
                                        },
                                    }
                                }
                            };
                            
                                chart = new Chart(
                                    document.getElementById('graphdisplay'),
                                    config
                                );
                                k++
                        }
                        else{
                            chart.data.labels = labels;
                            chart.data.datasets[0].data = itemdata;
                            chart.data.datasets[1].data = itemdata2;
                            chart.update()
                        }
                        
                    }
                    
                    var canvas = document.getElementById('graphdisplay');
                    var ctx = canvas.getContext('2d');
                    function needchart(){
                        return chart
                    }

                    function chartcolorchange(){
                            chart.options.scales.x.grid.color=chart.options.scales.y.grid.color = 'rgba(0, 0, 0, 0.07)';
                            chart.options.scales.x.ticks.color=chart.options.scales.y.ticks.color = 'black';
                            chart.update();
                    }

                    function setCanvasSize() {
                        if(window.innerWidth<700)
                        {
                            canvas.width = innerWidth*45;  
                            canvas.height=innerWidth*17
                        }
                        else{
                            if(window.innerWidth<1250)
                            {
                                canvas.width = 18800;  
                                canvas.height=2660
                            }
                            else{
                                canvas.width = 10800;  
                                canvas.height=2060
                            }
                        }
                        if(window.innerHeight>1600)
                        {
                            canvas.width = innerWidth*52;  
                            canvas.height=innerWidth*20
                        }
                        else{
                            if(window.innerHeight>1000)
                            {
                                canvas.width = innerWidth*62;  
                                canvas.height=innerWidth*20
                            }
                        }
                        
                    }

                    function graphtopanume(id,data,symbole){
                        data=parseInt(data)
                        timer_up1=30
                        data_olt=document.getElementById(id).innerHTML
                        if(data_olt==""){
                            data_olt=0
                            
                        }
                        else{
                            data_olt=parseInt(data_olt.replace(symbole, ''));
                        }
                        dif=Math.abs(data_olt-data)
                        if(dif>20){timer_up1=5}else{timer_up1=20}
                        if(data!=data_olt){

                        if(data_olt>data){
                            data_olt--;
                            $('#'+id).text(data_olt+symbole);
                            setTimeout(() => {
                                graphtopanume(id,data,symbole)
                            }, timer_up1); 
                        }
                        else if(data_olt<data){
                            data_olt++;}
                            $('#'+id).text(data_olt+symbole);
                            setTimeout(() => {
                                graphtopanume(id,data,symbole)
                            }, timer_up1);
                        }
                        }
                    setCanvasSize();
                    window.addEventListener('resize', setCanvasSize);
                    function theweekchange(){
                        thevalue=document.getElementById("weekorday")
                        previousbutton=document.getElementById("submitBtnpre")
                        nextbutton=document.getElementById("submitBtnnex")
                        if(dorw==1){dorw=0
                            thevalue.textContent="Daily weather "
                            nextbutton.textContent="Next Day"
                            previousbutton.textContent="Previous Day"
                        }
                        else{dorw=1
                            thevalue.textContent="Weekly weather"
                            nextbutton.textContent="Next week"
                            previousbutton.textContent="Previous week"
                        }
                        graphupdates(didval)
                    }
                </script>
                
                <div class="details_div2">
                    <input  id="thedatevalue" type="date" onchange="inputdataupdate()">
                    <div class="subdetails">
                        <div>
                            <div>
                                <div class="humditytitle">
                                    <b>{{ device.0.Name }}</b>
                                    <div class="icon" onclick="nextpagedata(404,1)"><b><ion-icon name="{{ device.0.Icon }}"></ion-icon></b></div>
                                </div>
                                <div class="humdity">
                                    <b id="humidity">0</b><b id="humsy" style="font-size: 27px; margin-left: 2px;">%</b>
                                </div>
                                <div class="level">
                                    <div class="limits">
                                        <div style="justify-content: baseline;" >0%</div>
                                        <div style="justify-content: center;">50%</div>
                                        <div style="justify-content: end;">100%</div>
                                    </div>
                                    <div class="levelbar">
                                        <div id="humiditybar" ></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="temperaturetitle">
                                    <b>{{ device.1.Name }}</b>
                                    <div id="ticon" class="icon" onclick="nextpagedata(404,2)"><b><ion-icon id="tempwarningicon" name="{{ device.1.Icon }}"></ion-icon></b></div>
                                </div>
                                <div class="temperatured">
                                    <b id="Temperature">0</b><b id="temsy" style="font-size: 30px; margin-left: 2px;"></b>
                                </div>
                                <div class="level">
                                    <div class="limits">
                                        <div style="justify-content: baseline;" >0Â°</div>
                                        <div style="justify-content: center;">50Â°</div>
                                        <div style="justify-content: end;">100Â°</div>
                                    </div>
                                    <div class="levelbar">
                                        <div id="Temperaturebar"></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="raintitle">
                                    <b >{{ device.4.Name }}</b>
                                    <div class="icon" id="rainicon" onclick="nextpagedata(5,1)">
                                        <b><ion-icon id="rainnew" name="{{ device.4.Name }}"></ion-icon></b></div>
                                </div>
                                <div class="rain">
                                    <b id="rain">0</b><b id="rainsy" style="font-size: 27px; margin-left: 2px;">%</b>
                                </div>
                                <div class="level">
                                    <div class="limits">
                                        <div style="justify-content: baseline;" >0%</div>
                                        <div style="justify-content: center;">50%</div>
                                        <div style="justify-content: end;">100%</div>
                                    </div>
                                    <div class="levelbar">
                                        <div id="rainbar"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div>
                                <div class="uvtitle">
                                    <b>{{ device.8.Name }}</b>
                                    <div class="icon" id="co2icon" onclick="nextpagedata(404,9)"><b><ion-icon name="{{ device.8.Icon }}"></ion-icon></b></div>
                                </div>
                                <div class="uvs">
                                    <b id="uvs">0</b><b id="uvssy" style="font-size: 27px; margin-left: 2px;">%</b>
                                </div>
                                <div class="level">
                                    <div class="limits">
                                        <div style="justify-content: baseline;" >0%</div>
                                        <div style="justify-content: center;">50%</div>
                                        <div style="justify-content: end;">100%</div>
                                    </div>
                                    <div class="levelbar">
                                        <div id="uvsbar"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="airqtitle">
                                    <b>{{ device.10.Name }}</b>
                                    <div id="theaq" class="icon" onclick="nextpagedata(404,11)">
                                        <b><ion-icon name="{{ device.10.Icon }}"></ion-icon></b></div>
                                </div>
                                <div class="airq">
                                    <b id="airq">0</b><b id="airsy" style="font-size: 14px; margin-left: 3px;"></b>
                                </div>
                                <div class="level">
                                    <div class="limits">
                                        <div style="justify-content: baseline;" >0m</div>
                                        <div style="justify-content: center;">100m</div>
                                        <div style="justify-content: end;">200m</div>
                                    </div>
                                    <div class="levelbar">
                                        <div id="airqbar"></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="atmtitle">
                                    <b >{{ device.7.Name }}</b>
                                    <div class="icon" id="atmicon" onclick="nextpagedata(8,1)">
                                        <b><ion-icon name="{{ device.7.Icon }}"></ion-icon></b></div>
                                </div>
                                <div class="atm">
                                    <div class="speedar">
                                        <div class="windpower">
                                            <div id="powerhigh3" class="windpowersub">
                                            </div>
                                        </div>
                                        <div id="ficr2" class="speedarcir2">
                                            <div  id="scecr2" class="seccirlcle2">
                                                <div  class="speedararrowco" id="atmbar">
                                                    <div class="speed1"></div>
                                                </div>
                                                <div class="speed2"></div>
                                            </div>
                                        </div>    
                                        <div class="windpower">
                                            <div id="powerhigh4" class="windpowersub">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="speedar2" ><b id="atmdata">0</b><b id="atmosy" style=" margin-left: 2px;">hPa</b></div>
                                </div>
                            </div>
                            
                        </div>
                        <div>
                            <div>
                                <div class="no2title">
                                    <b>{{ device.6.Name }}</b>
                                    <div class="icon" id="no2icon" onclick="nextpagedata(404,5)"><b><ion-icon name="{{ device.6.Icon }}"></ion-icon></b></div>
                                </div>
                                <div class="no2">
                                    <b id="no2">0</b><b id="n02sy" style="font-size: 27px;margin-left: 2px;">Âµg/mÂ³</b>
                                </div>
                                <div class="level">
                                    <div class="limits">
                                        <div style="justify-content: baseline;" >0{{ device.6.Symbole }}</div>
                                        <div style="justify-content: center;">50%</div>
                                        <div style="justify-content: end;">100%</div>
                                    </div>
                                    <div class="levelbar">
                                        <div id="no2bar"></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                
                                <div class="windtitle">
                                    <b >{{ device.5.Name }}</b>
                                    <div class="icon" id="windicon" onclick="nextpagedata(404,4)">
                                        <b><ion-icon name="{{ device.5.Icon }}"></ion-icon></b>
                                    </div>
                                </div>
                                <div class="wind">
                                    <div class="speedar">
                                        <div class="windpower">
                                            <div id="powerhigh1" class="windpowersub">
                                            </div>
                                        </div>
                                        <div id="ficr" class="speedarcir">
                                            <div id="scecr" class="seccirlcle">
                                                <div class="speedararrowco" id="windbar">
                                                    <div id="wibar" class="speed1"></div>
                                                </div>
                                                <div class="speed2"></div>
                                            </div>
                                        </div>    
                                        <div class="windpower">
                                            <div id="powerhigh2" class="windpowersub">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="speedar2" ><b id="winds">0</b><b id="windspsy" style=" margin-left: 2px;">km/h</b></div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="co2title">
                                    <b>{{ device.3.Name }}</b>
                                    <div class="icon" id="co2icon" onclick="nextpagedata(404,3)"><b><ion-icon id="co2warningicon" name="{{ device.3.Icon }}"></ion-icon></b></div>
                                </div>
                                <div class="co2">
                                    <b id="co2">0</b><b id="cosy" style="font-size: 27px; margin-left: 2px;">%</b>
                                </div>
                                <div class="level">
                                    <div class="limits">
                                        <div style="justify-content: baseline;" >0%</div>
                                        <div style="justify-content: center;">50%</div>
                                        <div style="justify-content: end;">100%</div>
                                    </div>
                                    <div class="levelbar">
                                        <div id="co2bar"></div>
                                    </div>
                                </div>
                            </div>

                            
                        </div>

                        <div>
                            <div>
                                <div class="soundtitle">
                                    <b>{{ device.2.Name }}</b>
                                    <div class="icon" onclick="nextpagedata(3,1)"><b><ion-icon name="{{ device.2.Icon }}"></ion-icon></b></div>
                                </div>
                                <div class="sound">
                                    <b id="Sound">0</b><b id="sousy" style="font-size: 27px; margin-left: 2px;">%</b>
                                </div>
                                <div class="level">
                                    <div class="limits">
                                        <div style="justify-content: baseline;" >0%</div>
                                        <div style="justify-content: center;">50%</div>
                                        <div style="justify-content: end;">100%</div>
                                    </div>
                                    <div class="levelbar">
                                        <div id="Soundbar" ></div>
                                    </div>
                                </div>
                            </div>
                            
                            
                            <div >
                                <div class="windirtitle">
                                    <b>{{ device.9.Name }}</b>
                                    <div class="icon" onclick="nextpagedata(404,1)"><b><ion-icon name="{{ device.9.Icon }}"></ion-icon></b></div>
                                </div>
                                <div class="wibr">
                                    <div class="dirdata"><table style="text-align: center;">
                                        <tr>
                                            <td id="topdir"></td>
                                        </tr>
                                        <tr >
                                            <td><ion-icon  name="arrow-up-outline"></ion-icon></td>
                                        </tr>
                                        <tr>
                                            <td id="bottomdir"></td>
                                        </tr>
                                    </table></div>
                                    <div id="load" class="dircir">
                                        <div id="dirwbar" class="dirarrow"></div>
                                    </div>
                                    <div class="dirdata">
                                        <div class="valuewind" id="winddeg"></div>
                                        <div class="valuewind2" id="windsp"></div>
                                    </div>
                                </div>
                            </div>

                            <a href="details"><div class="theviewmorebutton" style="display: flex; flex-direction: row; align-items: center; justify-content: center; font-size: 25px;">More details<ion-icon name="arrow-forward-outline"></ion-icon></div></a>
                        </div>
                    </div>
                </div>

            </div>
            
        </div>
        <script>
            widtempdir=-1;
            delays=5000;
            barcount=0;
            barcount2=-1;
            prvclass2=prvclass1="low"
            document.getElementById('thedatevalue').value=dayvalue;
            var onbar1=onbar2="5px solid rgb(6, 116, 212)"
            var offbar1=offbar2="5px solid rgb(194, 194, 194)"
            function fulldata(data) {
                humidityValue = data[0].device_values;
                data_animation_base(humidityValue,"humidity")
                $('#humsy').text(data[0].symbole);
                document.getElementById('humiditybar').style.width =  humidityValue+"%";
                document.getElementById('humiditybar').style.backgroundColor=data[0].Dev_Color;


                
                var temperatureValue = data[1].device_values;
                $('#temsy').text(data[1].symbole);
                data_animation_base(temperatureValue,"Temperature")
                document.getElementById('Temperaturebar').style.width =  temperatureValue+"%";
                document.getElementById('ticon').style.backgroundColor=data[1].Dev_Color;
                document.getElementById('Temperaturebar').style.backgroundColor=data[1].Dev_Color;
                document.getElementById('ticon').style.backgroundColor=data[1].Dev_Color;
                var tempbarwar = document.getElementById('Temperaturebar');
                if (tempbarwar.classList.contains('warning')) {
                    tempbarwar.classList.remove('warning');
                    document.getElementById('Temperature').classList.remove("colorWarning");document.getElementById('temsy').classList.remove("colorWarning")}
                if(temperatureValue >= "60"){tempbarwar.classList.add("warning");
                    document.getElementById('Temperature').classList.add("colorWarning");document.getElementById('temsy').classList.add("colorWarning")}
                


                var soundValue = data[2].device_values;
                $('#sousy').text(data[2].symbole);
                data_animation_base(soundValue,"Sound")
                document.getElementById('Soundbar').style.width =  soundValue+"%";
                document.getElementById('Soundbar').style.backgroundColor=data[2].Dev_Color;


                var co2Value = data[3].device_values;
                $('#cosy').text(data[3].symbole);
                data_animation_base(co2Value,"co2")
                document.getElementById('co2bar').style.width =  co2Value+"%";
                document.getElementById('co2bar').style.backgroundColor=data[3].Dev_Color;
                document.getElementById('co2icon').style.backgroundColor=data[3].bgicon;
                document.getElementById('co2icon').style.color=data[3].Icon_color;
                var co2WarningIcon = document.getElementById('co2bar');
                if (co2WarningIcon.classList.contains('warning')) {co2WarningIcon.classList.remove('warning');document.getElementById('co2').classList.remove('colorWarning');document.getElementById('cosy').classList.remove('colorWarning');}
                if(document.getElementById('co2').classList.contains('yellowWarning')){document.getElementById('co2').classList.remove('yellowWarning');document.getElementById('cosy').classList.remove('yellowWarning');}
                if(co2Value >= "90"){
                co2WarningIcon.classList.add('warning');
                document.getElementById('co2').classList.add('colorWarning');document.getElementById('cosy').classList.add('colorWarning');}
                else if(co2Value >= "55"){
                    document.getElementById('co2').classList.add('yellowWarning');
                    document.getElementById('cosy').classList.add('yellowWarning');
                }


                var rainValue = data[4].device_values;
                data_animation_base(rainValue,"rain")
                document.getElementById('rainbar').style.width =  rainValue+"%";
                document.getElementById('rainbar').style.backgroundColor=data[4].Dev_Color;
                document.getElementById('rainicon').style.backgroundColor=data[4].Dev_Color;
                document.getElementById('rainicon').style.color=data[4].Icon_color;
                document.getElementById('rainnew').setAttribute('name', data[4].Icon)
                



                var windValue = data[5].device_values;
                $('#windspsy').text(data[5].symbole);
                per=(180/30)*windValue;
                var windarrow = document.getElementById('windbar');
                if (windarrow.classList.contains('speedwarning')) {windarrow.classList.remove('speedwarning');}
                if(per<=0){per=0}
                else if(per>=180){per=180}
                data_animation_base(windValue,"winds")
                document.getElementById('windicon').style.color="white";
                document.getElementById('windbar').style.transform =  "rotate("+per+"deg)";
                tr1=per-45
                var levels1=document.getElementById('ficr')
                levels1.style.transform =  "rotate("+tr1+"deg)";
                document.getElementById('scecr').style.transform =  "rotate("+(tr1*-1)+"deg)";
                if(prvclass1!=data[5].barclass)
                    {
                        if(levels1.classList.contains(prvclass1)){
                        levels1.classList.remove(prvclass1)
                        levels1.classList.add(data[5].barclass)
                        prvclass1=data[5].barclass
                    }
                    else{levels1.classList.add(data[5].barclass);prvclass1=data[5].barclass}
                }
                
                if(barcount!=windValue)
                {   document.getElementById('powerhigh1').innerHTML = '';
                    document.getElementById('powerhigh2').innerHTML = '';
                    barcount = windValue;
                    createWindLevels(0,windValue);
                }


                var no2Value = data[6].device_values;
                $('#n02sy').text(data[6].symbole);
                data_animation_base(no2Value,"no2")
                document.getElementById('no2bar').style.width =  no2Value+"%";
                document.getElementById('no2bar').style.backgroundColor=data[6].Dev_Color;


                var atmValue = data[7].device_values;
                data_animation_base(atmValue,"atmdata")
                thepsvalue = ((atmValue - 300) / (1100 - 300)) * (180 - 0) + 0;
                if(thepsvalue<=0){thepsvalue=0}
                else if(thepsvalue>=180){thepsvalue=180}
                document.getElementById('atmbar').style.transform =  "rotate("+thepsvalue+"deg)";
                tr2=thepsvalue-45;
                var levelbar2=document.getElementById('ficr2')

                if(prvclass2!=data[7].barclass)
                    {
                        if(levelbar2.classList.contains(prvclass2)){
                        levelbar2.classList.remove(prvclass2)
                        levelbar2.classList.add(data[7].barclass)
                        prvclass2=data[7].barclass
                    }
                    else{levelbar2.classList.add(data[7].barclass);prvclass2=data[7].barclass}
                }


                levelbar2.style.transform =  "rotate("+tr2+"deg)";
                document.getElementById('scecr2').style.transform =  "rotate("+(tr2*-1)+"deg)";
                if(barcount2!=atmValue)
                {   document.getElementById('powerhigh3').innerHTML = '';
                    document.getElementById('powerhigh4').innerHTML = '';
                    barcount2 = atmValue;
                    if(atmValue<970){createatmLevels(0,atmValue,1);}
                    else{createatmLevels(930,atmValue,0);}
                }
                levelbar2.style.borderBottom = data[7].barbottom;
                levelbar2.style.borderRight = data[7].barrigth;
                    
                


                var uvrays = data[8].device_values;
                $('#uvssy').text(data[8].symbole);
                data_animation_base(uvrays,"uvs")
                document.getElementById('uvsbar').style.width =  uvrays+"%";
                document.getElementById('uvsbar').style.backgroundColor=data[8].Dev_Color;


                var winddir = data[9].device_values;
                if(widtempdir!=winddir)
                {                
                    widtempdir=winddir;
                    winddir=winddir%360;
                    document.getElementById('dirwbar').style.transform =  "rotate("+(winddir+90)+"deg)";

                    if(winddir==0){from="S";to="N";  }
                    else if(winddir==90){from="W";to="E"; }
                    else if(winddir==180){from="N";to="S";}
                    else if(winddir==270){from="E";to="W";}
                    else{
                        if(winddir<90){from="SW";to="NE";}
                        else if(winddir<180){from="NW";to="SE";}
                        else if(winddir<270){from="NE";to="SW";}
                        else if(winddir<360){from="SE";to="NW";}
                    }
                    $('#bottomdir').text(from);
                    $('#topdir').text(to);
                    $('#winddeg').text(winddir+"Â° "+to);
                    $('#windsp').text(windValue+" km/h");
                }

                var air = data[10].device_values;
                data_animation_base(air,"airq")
                $('#airsy').text(data[10].symbole);
                data_perca=(air/200)*100
                document.getElementById('airqbar').style.width =  data_perca+"%";
                document.getElementById('airqbar').style.backgroundColor=document.getElementById('theaq').style.backgroundColor=data[10].Dev_Color;
                
                
            }
            timer_up1=30
            function data_animation_base(data,data_id,to){
                data=parseInt(data)
                data_olt=parseInt(document.getElementById(data_id).innerHTML)
                dif=Math.abs(data_olt-data)
                if(data_id!="atmdata")
                {if(dif>30){timer_up1=5} else if(dif<5){timer_up1=200}else{timer_up1=30}}
                else{timer_up1=40;}
                if(data_olt>data){
                    if(data_id!="atmdata"){data_olt--;}
                    else{data_olt=data_olt-30; if(data_olt<data){data_olt=data}}
                    $('#'+data_id).text(data_olt);
                    setTimeout(() => {
                        data_animation_base(data,data_id)
                    }, timer_up1); 
                }
                else if(data_olt<data){
                    if(data_id!="atmdata"){data_olt++;}
                    else{data_olt=data_olt+30; if(data_olt>data){data_olt=data}}
                    $('#'+data_id).text(data_olt);
                    setTimeout(() => {
                        data_animation_base(data,data_id)
                    }, timer_up1);
                }
                
            }


            function createWindLevels(i,windValue) {
                let divcolor;
            
                if (i < windValue && i<30) {
                    const newDiv1 = document.createElement("div");
                    const newDiv2 = document.createElement("div");
                    newDiv1.classList.add("windlevel");
                    newDiv2.classList.add("windlevel");
                    doc1p=document.getElementById('powerhigh1');
                    doc2p=document.getElementById('powerhigh2');
                    if (i < 12) {
                        newDiv1.classList.add("green");
                        newDiv2.classList.add("green");
                    } else if (i < 18) {
                        newDiv1.classList.add("orange");
                        newDiv2.classList.add("orange");
                    } else {
                        newDiv1.classList.add("red");
                        newDiv2.classList.add("red");
                    }
            
                    newDiv1.style.backgroundColor = divcolor;
                    newDiv2.style.backgroundColor = divcolor;
            
                    doc1p.appendChild(newDiv1);
                    doc2p.appendChild(newDiv2);
                    setTimeout(() => createWindLevels(i + 3,windValue), 200);
                }
            }
            function createatmLevels(i,atmValue,k) {
                let divcolor;
                if(k==0)
                {
                    if (i < atmValue && i<1100) {
                        const newDiv1 = document.createElement("div");
                        const newDiv2 = document.createElement("div");
                        newDiv1.classList.add("atmlevel");
                        newDiv2.classList.add("atmlevel");
                
                        if (i <= 980) {
                            newDiv1.classList.add("orange");
                            newDiv2.classList.add("orange");
                        } else if (i < 1050) {
                            newDiv1.classList.add("green");
                            newDiv2.classList.add("green");
                        } else {
                            newDiv1.classList.add("red");
                            newDiv2.classList.add("red");
                        }
                
                        newDiv1.style.backgroundColor = divcolor;
                        newDiv2.style.backgroundColor = divcolor;
                
                        document.getElementById('powerhigh3').appendChild(newDiv1);
                        document.getElementById('powerhigh4').appendChild(newDiv2);
                        setTimeout(() => createatmLevels(i + 17,atmValue,k), 200);
                    }
                }
                else{
                    if (i < 10) {
                        const newDiv1 = document.createElement("div");
                        const newDiv2 = document.createElement("div");
                        newDiv1.classList.add("atmlevel");
                        newDiv2.classList.add("atmlevel");
                        divcolor = "red";
                        newDiv1.style.backgroundColor = divcolor;
                        newDiv2.style.backgroundColor = divcolor;
                
                        document.getElementById('powerhigh3').appendChild(newDiv1);
                        document.getElementById('powerhigh4').appendChild(newDiv2);
                        setTimeout(() => createatmLevels(i + 1,atmValue,k), 200);
                    }

                }
            }

            function ajaxrepeator() {
                graphupdates(didval);
                fullalldaydata();
                setInterval(function() {
                    graphupdates(didval);
                    fullalldaydata();
                }, 5000);
            }
            ajaxrepeator();
            

            function fullalldaydata() {
                
                $.ajax({
                    url: '/all_data/',
                    method: 'GET',
                    data: { 'devdates': dayvalue }, 
                    dataType: 'json',
                    success: function (data) {
                        fulldata(data);
                    },
                    error: function (error) {
                        console.error('Error fetching live data:', error);
                    }
                });
            }
            var grtemp=[]
            function graphupdates(dv_id) {
                didval=dv_id
                $.ajax({
                    url: '/graph_data/',
                    method: 'GET',
                    data: { 'grdates': lastdate1, 'dorw': dorw, 'Device_id': dv_id }, 
                    dataType: 'json',
                    success: function (data) {
                        if(lastdate1==thedatefor && dorw==0){
                            $('#mainweekday').text("Today's "+data[0].Names+" ");}
                        else if(dorw==1){$('#mainweekday').text("Weekly "+data[0].Names+" ");}
                        else if(dorw==0){$('#mainweekday').text(lastdate1+" "+data[0].Names+" ");}
                        var areEqual = JSON.stringify(grtemp) === JSON.stringify(data);
                        if(!areEqual)
                        {
                            grtemp=data
                            graph(data);
                        }

                        
                    },
                    error: function (error) {
                        console.error('Error fetching live data:', error);
                    }
                });
            }


            function dateupdations(val) {
                para=val
                $.ajax({
                    url: '/value_up/',
                    method: 'GET',
                    data: { 'way': para,
                            'grdates': lastdate1,'dorw':dorw }, 
                    dataType: 'json',
                    success: function (data) {
                        lastdate1=data;
                        graphupdates(didval);
                    },
                    error: function (error) {
                        console.error('Error fetching new date:', error);
                    },
                });
            }
            function inputdataupdate() {
                var inputElement = document.getElementById('thedatevalue').value;
                $.ajax({
                    url: '/day_update/',
                    method: 'GET',
                    data: { 'dates': inputElement }, 
                    dataType: 'json',
                    success: function (data) {
                        dayvalue=inputElement
                        fullalldaydata();
                    },
                    error: function (error) {
                        console.error('Error fetching new date:', error);
                    },
                });
            }
            
        </script>
        {% endblock details %}
        <script>
            todaytemper();
            function todaytemper() {
                $.ajax({
                    url: '/today_temp/',
                    method: 'GET',
                    dataType: 'json',
                    success: function (data) {
                        var newdata = data.split(',');
                        data_animation(newdata[0],newdata[4],"todayTemperature")
                        $('#todaydate').text("Today "+newdata[1]);
                        $('#todaytime').text(newdata[2]);
                        if(newdata[3]=="None"){
                            document.getElementById("todayTemperature").style.color="yellow";
                        }
                        else{document.getElementById("todayTemperature").style.color="white";}
                    },
                    error: function (error) {
                        console.error('Error fetching live data:', error);
                    },
                    complete: function () {
                        setTimeout(todaytemper, 5000);
                    }
                });
            }
            themecheck()
            timer_up=30
            function data_animation(temp,symbole,id){
                temp=parseInt(temp)
                data_olt=document.getElementById(id).innerHTML
                data_olt=parseInt(data_olt.replace("Â°", ''));
                dif=Math.abs(data_olt-temp)
                if(dif<5){timer_up=500}else{timer_up=30}
                if(data_olt>temp){
                    data_olt--;
                    $('#'+id).text(data_olt+""+symbole);
                    setTimeout(() => {
                        data_animation(temp,symbole,id)
                    }, timer_up); 
                }
                else if(data_olt<temp){
                    data_olt++;
                    $('#'+id).text(data_olt+""+symbole);
                    setTimeout(() => {
                        data_animation(temp,symbole,id)
                    }, timer_up);
                }
                
            }
        </script>
        <script src="https://kit.fontawesome.com/bc67d18a07.js" crossorigin="anonymous"></script>
        <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
        <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    </body>
</html>